<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FeelPic Â· AIæƒ…ç»ªæ’ç”»ç”Ÿæˆå™¨</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>FeelPic</h1>
    <p>è¾“å…¥ä½ çš„æƒ…ç»ªï¼Œè®©AIä¸ºä½ ç”Ÿæˆä¸€å¼ ä¸“å±æ’ç”»</p>
    <input type="text" id="promptInput" placeholder="å¦‚ï¼šä¸€ä¸ªå­¤ç‹¬çš„å°‘å¹´ç«™åœ¨é›¨ä¸­" />
    <button onclick="generateImage()">ç”Ÿæˆæ’ç”»</button>
    <div id="result">
      <p id="status"></p>
      <img id="outputImage" src="" style="display:none;max-width:100%;margin-top:20px;border-radius:12px;" />

      <!-- ğŸ”’ å£ä»¤è¾“å…¥é€»è¾‘å¼€å§‹ -->
      <div id="lockSection" style="display:none; margin-top: 15px;">
        <p style="margin-bottom: 5px;">è¯·è¾“å…¥å£ä»¤è§£é”ä¸‹è½½ï¼š</p>
        <input type="password" id="unlockCode" placeholder="è¯·è¾“å…¥ä¸‹è½½å£ä»¤" style="padding:8px; border-radius:4px; border:1px solid #ccc;" />
        <button onclick="checkCode()" style="margin-left:10px;">ç¡®è®¤</button>
        <p id="codeHint" style="color:#f87171;"></p>
      </div>

      <a id="downloadBtn" href="#" download="feelpic.jpg"
        style="display:none;margin-top:10px;display:inline-block;background:#10b981;color:#fff;padding:8px 16px;border-radius:6px;text-decoration:none;">
        ä¸‹è½½æ’ç”»
      </a>
    </div>
  </div>

  <script>
    async function generateImage() {
      const prompt = document.getElementById("promptInput").value;
      if (!prompt) {
        alert("è¯·è¾“å…¥ä¸€å¥æè¿°ï¼Œä¾‹å¦‚ï¼šä¸€ä¸ªäººåœ¨æ˜Ÿç©ºä¸‹éª‘è‡ªè¡Œè½¦");
        return;
      }

      document.getElementById("status").innerText = "AIæ­£åœ¨ç”Ÿæˆæ’ç”»ï¼Œè¯·ç¨ç­‰...";
      document.getElementById("outputImage").style.display = "none";
      document.getElementById("downloadBtn").style.display = "none";

      try {
        const response = await fetch("/api/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ prompt })
        });

        const result = await response.json();

        if (result?.image) {
          const imageUrl = result.image;
          document.getElementById("status").innerText = "ç”ŸæˆæˆåŠŸ âœ…";
          const img = document.getElementById("outputImage");
          img.src = imageUrl;
          img.style.display = "block";
          document.getElementById("lockSection").style.display = "block";
          const downloadBtn = document.getElementById("downloadBtn");
          downloadBtn.href = imageUrl;
        } else {
          document.getElementById("status").innerText = "ç”Ÿæˆå¤±è´¥ âŒ";
        }
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "è¯·æ±‚å‡ºé”™ âŒ";
      }
    }

    function checkCode() {
      const code = document.getElementById("unlockCode").value.trim();
      const correctCode = "vip520";
      const hint = document.getElementById("codeHint");

      if (code === correctCode) {
        document.getElementById("downloadBtn").style.display = "inline-block";
        hint.innerText = "âœ”ï¸ è§£é”æˆåŠŸï¼ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¿å­˜æ’ç”»ã€‚";
        hint.style.color = "#10b981";
      } else {
        hint.innerText = "âŒ å£ä»¤é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚";
        hint.style.color = "#f87171";
      }
    }
  </script>
</body>
</html>
